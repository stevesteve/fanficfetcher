function setProgress(t){$(".progress-bar").css({width:t+"%"})}function startFetch(t){$.ajax({url:"fetchStory",type:"POST",data:{id:t},async:!0,cache:!1,success:function(e){console.log(e),-1==e.status?(console.log("answer was fail"),enableFetch(),showError("",e.msg)):1==e.status&&($("#hidden").html("<form action='download' method='post' name='download'><input name='id' value='"+t+"' type='hidden' ></input><input name='fname' value='ayy' type='hidden' ></input></form>"),document.forms.download.submit(),enableFetch())}})}function refreshProgress(t){$.ajax({url:"getStatus",type:"POST",data:{id:t},async:!0,cache:!1,success:function(e){try{setProgress(e.currentChapter/e.totalChapters*100)}catch(r){}console.log(e);try{e.totalChapters!=e.currentChapter?refreshProgress(t):setProgress(0)}catch(r){alert(r),refreshProgress(t)}}})}function enableFetch(){$(".fetch").html("Fetch!"),$(".fetch").removeAttr("disabled")}function disableFetch(){$(".fetch").html('Fetching...<span class="glyphicon loading" style="top:3px; display: inline-block; width:16px; height:16px; background-image: url(img/spinner.gif); background-repeat:no-repeat; background-size:cover;"></span>'),$(".fetch").attr("disabled","disabled")}function showError(t,e){element=$('<div class="alert alert-danger" role="alert">'+e+"</div>"),$("#alerts").append(element),element.hide().fadeIn(200).delay(5e3).fadeOut(200)}String.prototype.startsWith=function(t){return 0===this.indexOf(t)},String.prototype.endsWith=function(t){return this.match(t+"$")==t},$("document").ready(function(){$(".fetch").on("click",function(){disableFetch(),$.post("createJob",{url:$(".url").val()}).done(function(t){console.log(t),-1==t.status&&(console.log("answer was fail"),enableFetch(),showError("",t.msg)),1==t.status&&(console.log("starting fetch"),startFetch(t.dlid),refreshProgress(t.dlid))})}),$(".url").on("input",function(){url=$(".url").val(),console.log(url),url.startsWith("http://")&&(url=url.replace("http://",""),$(".url").val(url),$(".protocol").text("http://")),url.startsWith("https://")&&(url=url.replace("https://",""),$(".url").val(url),$(".protocol").text("https://"))})});