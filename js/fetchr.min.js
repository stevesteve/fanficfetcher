function setProgress(e){$(".progress-bar").css({width:e+"%"})}function startFetch(e){$.ajax({url:"download.php",type:"POST",data:{id:e},async:true,cache:false,success:function(e){console.log(e);if(e.status==-1){console.log("answer was fail");enableFetch();showError("",e.msg)}}})}function refreshProgress(e){$.ajax({url:"getstatus.php",type:"POST",data:{id:e},async:true,cache:false,success:function(t){try{setProgress(t.currentChapter/t.totalChapters*100)}catch(n){}console.log(t);try{if(t.totalChapters!=t.currentChapter){refreshProgress(e)}else{enableFetch();$("#hidden").html("<form action='transmit.php' method='post' name='transmit'><input name='id' value='"+e+"' type='hidden' ></input><input name='fname' value='ayy' type='hidden' ></input></form>");document.forms["transmit"].submit();setProgress(0)}}catch(n){alert(n);refreshProgress(e)}}})}function enableFetch(){$(".fetch").html("Fetch!");$(".fetch").removeAttr("disabled")}function disableFetch(){$(".fetch").html('Fetching...<span class="glyphicon loading" style="top:3px; display: inline-block; width:16px; height:16px; background-image: url(img/spinner.gif); background-repeat:no-repeat; background-size:cover;"></span>');$(".fetch").attr("disabled","disabled")}function showError(e,t){element=$('<div class="alert alert-danger" role="alert">'+t+"</div>");$("#alerts").append(element);element.hide().fadeIn(200).delay(5e3).fadeOut(200)}String.prototype.startsWith=function(e){return this.indexOf(e)===0};String.prototype.endsWith=function(e){return this.match(e+"$")==e};$("document").ready(function(){$(".fetch").on("click",function(){disableFetch();$.post("fetchr.php",{url:$(".url").val()}).done(function(e){console.log(e);if(e.status==-1){console.log("answer was fail");enableFetch();showError("",e.msg)}if(e.status==1){console.log("starting fetch");startFetch(e.dlid)}})});$(".url").on("input",function(){url=$(".url").val();console.log(url);if(url.startsWith("http://")){url=url.replace("http://","");$(".url").val(url);$(".protocol").text("http://")}if(url.startsWith("https://")){url=url.replace("https://","");$(".url").val(url);$(".protocol").text("https://")}})})